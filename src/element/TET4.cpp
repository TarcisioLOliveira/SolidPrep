/*
 *   Copyright (C) 2021 Tarc√≠sio Ladeia de Oliveira.
 *
 *   This file is part of SolidPrep
 *
 *   SolidPrep is free software: you can redistribute it and/or modify
 *   it under the terms of the GNU General Public License as published by
 *   the Free Software Foundation, either version 3 of the License, or
 *   (at your option) any later version.
 *
 *   SolidPrep is distributed in the hope that it will be useful,
 *   but WITHOUT ANY WARRANTY; without even the implied warranty of
 *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *   GNU General Public License for more details.
 *
 *   You should have received a copy of the GNU General Public License
 *   along with SolidPrep.  If not, see <https://www.gnu.org/licenses/>.
 *
 */

#include "element/TET4.hpp"
#include "cblas.h"
#include "logger.hpp"
#include <BRepBuilderAPI_MakeVertex.hxx>
#include <BRepBuilderAPI_MakeEdge.hxx>
#include <BRepBuilderAPI_MakeWire.hxx>
#include <BRepBuilderAPI_MakeFace.hxx>
#include <TopoDS_Wire.hxx>
#include <TopoDS_Face.hxx>
#include <TopoDS.hxx>
#include <IntTools_EdgeEdge.hxx>
#include <lapacke.h>

namespace element{

TET4::TET4(ElementShape s):
    MeshElementCommon3DTet<TET4>(s.nodes){

    this->get_coeffs();    
}

void TET4::get_coeffs(){
    constexpr size_t N = TET4::NODES_PER_ELEM;
    std::array<double, N> x, y, z;
    for(size_t i = 0; i < N; ++i){
        x[i] = this->nodes[i]->point.X();
        y[i] = this->nodes[i]->point.Y();
        z[i] = this->nodes[i]->point.Z();
    }

    std::array<double, N*N> M = 
        {1, x[0], y[0], z[0],
         1, x[1], y[1], z[1],
         1, x[2], y[2], z[2],
         1, x[3], y[3], z[3]};

    std::array<int, N> ipiv;

    // M*C = I -> C=M^-1
    // C = {a[0], a[1], a[2], a[3],
    //      b[0], b[1], b[2], b[3],
    //      c[0], c[1], c[2], c[3],
    //      d[0], d[1], d[2], d[3]}
    int info = LAPACKE_dgetrf(LAPACK_COL_MAJOR, N, N, M.data(), N, ipiv.data());
    logger::log_assert(info == 0, logger::ERROR, "LAPACKE returned {} while calculating LU in Q4.", info);
    info = LAPACKE_dgetri(LAPACK_COL_MAJOR, N, M.data(), N, ipiv.data());
    logger::log_assert(info == 0, logger::ERROR, "LAPACKE returned {} while calculating computing inverse from LU in Q4.", info);

    this->V = this->get_volume(1.0);
    for(auto& m:M){
        m *= 6*V;
    }

    std::copy(M.begin(), M.begin()+4, a);
    std::copy(M.begin()+4, M.begin()+8, b);
    std::copy(M.begin()+8, M.begin()+12, c);
    std::copy(M.begin()+12, M.begin()+16, d);
}

std::vector<double> TET4::get_k(const std::vector<double>& D, const double t) const{

std::vector<double> k{
(D[0]*b[0]*b[0] + D[18]*b[0]*c[0] + D[21]*c[0]*c[0] + D[23]*c[0]*d[0] + D[3]*b[0]*c[0] + D[30]*b[0]*d[0] + D[33]*c[0]*d[0] + D[35]*d[0]*d[0] + D[5]*b[0]*d[0])/(36*V)
,
(D[1]*b[0]*c[0] + D[19]*c[0]*c[0] + D[21]*b[0]*c[0] + D[22]*c[0]*d[0] + D[3]*b[0]*b[0] + D[31]*c[0]*d[0] + D[33]*b[0]*d[0] + D[34]*d[0]*d[0] + D[4]*b[0]*d[0])/(36*V)
,
(D[2]*b[0]*d[0] + D[20]*c[0]*d[0] + D[22]*c[0]*c[0] + D[23]*b[0]*c[0] + D[32]*d[0]*d[0] + D[34]*c[0]*d[0] + D[35]*b[0]*d[0] + D[4]*b[0]*c[0] + D[5]*b[0]*b[0])/(36*V)
,
(D[0]*b[0]*b[1] + D[18]*b[1]*c[0] + D[21]*c[0]*c[1] + D[23]*c[0]*d[1] + D[3]*b[0]*c[1] + D[30]*b[1]*d[0] + D[33]*c[1]*d[0] + D[35]*d[0]*d[1] + D[5]*b[0]*d[1])/(36*V)
,
(D[1]*b[0]*c[1] + D[19]*c[0]*c[1] + D[21]*b[1]*c[0] + D[22]*c[0]*d[1] + D[3]*b[0]*b[1] + D[31]*c[1]*d[0] + D[33]*b[1]*d[0] + D[34]*d[0]*d[1] + D[4]*b[0]*d[1])/(36*V)
,
(D[2]*b[0]*d[1] + D[20]*c[0]*d[1] + D[22]*c[0]*c[1] + D[23]*b[1]*c[0] + D[32]*d[0]*d[1] + D[34]*c[1]*d[0] + D[35]*b[1]*d[0] + D[4]*b[0]*c[1] + D[5]*b[0]*b[1])/(36*V)
,
(D[0]*b[0]*b[2] + D[18]*b[2]*c[0] + D[21]*c[0]*c[2] + D[23]*c[0]*d[2] + D[3]*b[0]*c[2] + D[30]*b[2]*d[0] + D[33]*c[2]*d[0] + D[35]*d[0]*d[2] + D[5]*b[0]*d[2])/(36*V)
,
(D[1]*b[0]*c[2] + D[19]*c[0]*c[2] + D[21]*b[2]*c[0] + D[22]*c[0]*d[2] + D[3]*b[0]*b[2] + D[31]*c[2]*d[0] + D[33]*b[2]*d[0] + D[34]*d[0]*d[2] + D[4]*b[0]*d[2])/(36*V)
,
(D[2]*b[0]*d[2] + D[20]*c[0]*d[2] + D[22]*c[0]*c[2] + D[23]*b[2]*c[0] + D[32]*d[0]*d[2] + D[34]*c[2]*d[0] + D[35]*b[2]*d[0] + D[4]*b[0]*c[2] + D[5]*b[0]*b[2])/(36*V)
,
(D[0]*b[0]*b[3] + D[18]*b[3]*c[0] + D[21]*c[0]*c[3] + D[23]*c[0]*d[3] + D[3]*b[0]*c[3] + D[30]*b[3]*d[0] + D[33]*c[3]*d[0] + D[35]*d[0]*d[3] + D[5]*b[0]*d[3])/(36*V)
,
(D[1]*b[0]*c[3] + D[19]*c[0]*c[3] + D[21]*b[3]*c[0] + D[22]*c[0]*d[3] + D[3]*b[0]*b[3] + D[31]*c[3]*d[0] + D[33]*b[3]*d[0] + D[34]*d[0]*d[3] + D[4]*b[0]*d[3])/(36*V)
,
(D[2]*b[0]*d[3] + D[20]*c[0]*d[3] + D[22]*c[0]*c[3] + D[23]*b[3]*c[0] + D[32]*d[0]*d[3] + D[34]*c[3]*d[0] + D[35]*b[3]*d[0] + D[4]*b[0]*c[3] + D[5]*b[0]*b[3])/(36*V)
,
(D[11]*c[0]*d[0] + D[18]*b[0]*b[0] + D[21]*b[0]*c[0] + D[23]*b[0]*d[0] + D[24]*b[0]*d[0] + D[27]*c[0]*d[0] + D[29]*d[0]*d[0] + D[6]*b[0]*c[0] + D[9]*c[0]*c[0])/(36*V)
,
(D[10]*c[0]*d[0] + D[19]*b[0]*c[0] + D[21]*b[0]*b[0] + D[22]*b[0]*d[0] + D[25]*c[0]*d[0] + D[27]*b[0]*d[0] + D[28]*d[0]*d[0] + D[7]*c[0]*c[0] + D[9]*b[0]*c[0])/(36*V)
,
(D[10]*c[0]*c[0] + D[11]*b[0]*c[0] + D[20]*b[0]*d[0] + D[22]*b[0]*c[0] + D[23]*b[0]*b[0] + D[26]*d[0]*d[0] + D[28]*c[0]*d[0] + D[29]*b[0]*d[0] + D[8]*c[0]*d[0])/(36*V)
,
(D[11]*c[0]*d[1] + D[18]*b[0]*b[1] + D[21]*b[0]*c[1] + D[23]*b[0]*d[1] + D[24]*b[1]*d[0] + D[27]*c[1]*d[0] + D[29]*d[0]*d[1] + D[6]*b[1]*c[0] + D[9]*c[0]*c[1])/(36*V)
,
(D[10]*c[0]*d[1] + D[19]*b[0]*c[1] + D[21]*b[0]*b[1] + D[22]*b[0]*d[1] + D[25]*c[1]*d[0] + D[27]*b[1]*d[0] + D[28]*d[0]*d[1] + D[7]*c[0]*c[1] + D[9]*b[1]*c[0])/(36*V)
,
(D[10]*c[0]*c[1] + D[11]*b[1]*c[0] + D[20]*b[0]*d[1] + D[22]*b[0]*c[1] + D[23]*b[0]*b[1] + D[26]*d[0]*d[1] + D[28]*c[1]*d[0] + D[29]*b[1]*d[0] + D[8]*c[0]*d[1])/(36*V)
,
(D[11]*c[0]*d[2] + D[18]*b[0]*b[2] + D[21]*b[0]*c[2] + D[23]*b[0]*d[2] + D[24]*b[2]*d[0] + D[27]*c[2]*d[0] + D[29]*d[0]*d[2] + D[6]*b[2]*c[0] + D[9]*c[0]*c[2])/(36*V)
,
(D[10]*c[0]*d[2] + D[19]*b[0]*c[2] + D[21]*b[0]*b[2] + D[22]*b[0]*d[2] + D[25]*c[2]*d[0] + D[27]*b[2]*d[0] + D[28]*d[0]*d[2] + D[7]*c[0]*c[2] + D[9]*b[2]*c[0])/(36*V)
,
(D[10]*c[0]*c[2] + D[11]*b[2]*c[0] + D[20]*b[0]*d[2] + D[22]*b[0]*c[2] + D[23]*b[0]*b[2] + D[26]*d[0]*d[2] + D[28]*c[2]*d[0] + D[29]*b[2]*d[0] + D[8]*c[0]*d[2])/(36*V)
,
(D[11]*c[0]*d[3] + D[18]*b[0]*b[3] + D[21]*b[0]*c[3] + D[23]*b[0]*d[3] + D[24]*b[3]*d[0] + D[27]*c[3]*d[0] + D[29]*d[0]*d[3] + D[6]*b[3]*c[0] + D[9]*c[0]*c[3])/(36*V)
,
(D[10]*c[0]*d[3] + D[19]*b[0]*c[3] + D[21]*b[0]*b[3] + D[22]*b[0]*d[3] + D[25]*c[3]*d[0] + D[27]*b[3]*d[0] + D[28]*d[0]*d[3] + D[7]*c[0]*c[3] + D[9]*b[3]*c[0])/(36*V)
,
(D[10]*c[0]*c[3] + D[11]*b[3]*c[0] + D[20]*b[0]*d[3] + D[22]*b[0]*c[3] + D[23]*b[0]*b[3] + D[26]*d[0]*d[3] + D[28]*c[3]*d[0] + D[29]*b[3]*d[0] + D[8]*c[0]*d[3])/(36*V)
,
(D[12]*b[0]*d[0] + D[15]*c[0]*d[0] + D[17]*d[0]*d[0] + D[24]*b[0]*c[0] + D[27]*c[0]*c[0] + D[29]*c[0]*d[0] + D[30]*b[0]*b[0] + D[33]*b[0]*c[0] + D[35]*b[0]*d[0])/(36*V)
,
(D[13]*c[0]*d[0] + D[15]*b[0]*d[0] + D[16]*d[0]*d[0] + D[25]*c[0]*c[0] + D[27]*b[0]*c[0] + D[28]*c[0]*d[0] + D[31]*b[0]*c[0] + D[33]*b[0]*b[0] + D[34]*b[0]*d[0])/(36*V)
,
(D[14]*d[0]*d[0] + D[16]*c[0]*d[0] + D[17]*b[0]*d[0] + D[26]*c[0]*d[0] + D[28]*c[0]*c[0] + D[29]*b[0]*c[0] + D[32]*b[0]*d[0] + D[34]*b[0]*c[0] + D[35]*b[0]*b[0])/(36*V)
,
(D[12]*b[1]*d[0] + D[15]*c[1]*d[0] + D[17]*d[0]*d[1] + D[24]*b[1]*c[0] + D[27]*c[0]*c[1] + D[29]*c[0]*d[1] + D[30]*b[0]*b[1] + D[33]*b[0]*c[1] + D[35]*b[0]*d[1])/(36*V)
,
(D[13]*c[1]*d[0] + D[15]*b[1]*d[0] + D[16]*d[0]*d[1] + D[25]*c[0]*c[1] + D[27]*b[1]*c[0] + D[28]*c[0]*d[1] + D[31]*b[0]*c[1] + D[33]*b[0]*b[1] + D[34]*b[0]*d[1])/(36*V)
,
(D[14]*d[0]*d[1] + D[16]*c[1]*d[0] + D[17]*b[1]*d[0] + D[26]*c[0]*d[1] + D[28]*c[0]*c[1] + D[29]*b[1]*c[0] + D[32]*b[0]*d[1] + D[34]*b[0]*c[1] + D[35]*b[0]*b[1])/(36*V)
,
(D[12]*b[2]*d[0] + D[15]*c[2]*d[0] + D[17]*d[0]*d[2] + D[24]*b[2]*c[0] + D[27]*c[0]*c[2] + D[29]*c[0]*d[2] + D[30]*b[0]*b[2] + D[33]*b[0]*c[2] + D[35]*b[0]*d[2])/(36*V)
,
(D[13]*c[2]*d[0] + D[15]*b[2]*d[0] + D[16]*d[0]*d[2] + D[25]*c[0]*c[2] + D[27]*b[2]*c[0] + D[28]*c[0]*d[2] + D[31]*b[0]*c[2] + D[33]*b[0]*b[2] + D[34]*b[0]*d[2])/(36*V)
,
(D[14]*d[0]*d[2] + D[16]*c[2]*d[0] + D[17]*b[2]*d[0] + D[26]*c[0]*d[2] + D[28]*c[0]*c[2] + D[29]*b[2]*c[0] + D[32]*b[0]*d[2] + D[34]*b[0]*c[2] + D[35]*b[0]*b[2])/(36*V)
,
(D[12]*b[3]*d[0] + D[15]*c[3]*d[0] + D[17]*d[0]*d[3] + D[24]*b[3]*c[0] + D[27]*c[0]*c[3] + D[29]*c[0]*d[3] + D[30]*b[0]*b[3] + D[33]*b[0]*c[3] + D[35]*b[0]*d[3])/(36*V)
,
(D[13]*c[3]*d[0] + D[15]*b[3]*d[0] + D[16]*d[0]*d[3] + D[25]*c[0]*c[3] + D[27]*b[3]*c[0] + D[28]*c[0]*d[3] + D[31]*b[0]*c[3] + D[33]*b[0]*b[3] + D[34]*b[0]*d[3])/(36*V)
,
(D[14]*d[0]*d[3] + D[16]*c[3]*d[0] + D[17]*b[3]*d[0] + D[26]*c[0]*d[3] + D[28]*c[0]*c[3] + D[29]*b[3]*c[0] + D[32]*b[0]*d[3] + D[34]*b[0]*c[3] + D[35]*b[0]*b[3])/(36*V)
,
(D[0]*b[0]*b[1] + D[18]*b[0]*c[1] + D[21]*c[0]*c[1] + D[23]*c[1]*d[0] + D[3]*b[1]*c[0] + D[30]*b[0]*d[1] + D[33]*c[0]*d[1] + D[35]*d[0]*d[1] + D[5]*b[1]*d[0])/(36*V)
,
(D[1]*b[1]*c[0] + D[19]*c[0]*c[1] + D[21]*b[0]*c[1] + D[22]*c[1]*d[0] + D[3]*b[0]*b[1] + D[31]*c[0]*d[1] + D[33]*b[0]*d[1] + D[34]*d[0]*d[1] + D[4]*b[1]*d[0])/(36*V)
,
(D[2]*b[1]*d[0] + D[20]*c[1]*d[0] + D[22]*c[0]*c[1] + D[23]*b[0]*c[1] + D[32]*d[0]*d[1] + D[34]*c[0]*d[1] + D[35]*b[0]*d[1] + D[4]*b[1]*c[0] + D[5]*b[0]*b[1])/(36*V)
,
(D[0]*b[1]*b[1] + D[18]*b[1]*c[1] + D[21]*c[1]*c[1] + D[23]*c[1]*d[1] + D[3]*b[1]*c[1] + D[30]*b[1]*d[1] + D[33]*c[1]*d[1] + D[35]*d[1]*d[1] + D[5]*b[1]*d[1])/(36*V)
,
(D[1]*b[1]*c[1] + D[19]*c[1]*c[1] + D[21]*b[1]*c[1] + D[22]*c[1]*d[1] + D[3]*b[1]*b[1] + D[31]*c[1]*d[1] + D[33]*b[1]*d[1] + D[34]*d[1]*d[1] + D[4]*b[1]*d[1])/(36*V)
,
(D[2]*b[1]*d[1] + D[20]*c[1]*d[1] + D[22]*c[1]*c[1] + D[23]*b[1]*c[1] + D[32]*d[1]*d[1] + D[34]*c[1]*d[1] + D[35]*b[1]*d[1] + D[4]*b[1]*c[1] + D[5]*b[1]*b[1])/(36*V)
,
(D[0]*b[1]*b[2] + D[18]*b[2]*c[1] + D[21]*c[1]*c[2] + D[23]*c[1]*d[2] + D[3]*b[1]*c[2] + D[30]*b[2]*d[1] + D[33]*c[2]*d[1] + D[35]*d[1]*d[2] + D[5]*b[1]*d[2])/(36*V)
,
(D[1]*b[1]*c[2] + D[19]*c[1]*c[2] + D[21]*b[2]*c[1] + D[22]*c[1]*d[2] + D[3]*b[1]*b[2] + D[31]*c[2]*d[1] + D[33]*b[2]*d[1] + D[34]*d[1]*d[2] + D[4]*b[1]*d[2])/(36*V)
,
(D[2]*b[1]*d[2] + D[20]*c[1]*d[2] + D[22]*c[1]*c[2] + D[23]*b[2]*c[1] + D[32]*d[1]*d[2] + D[34]*c[2]*d[1] + D[35]*b[2]*d[1] + D[4]*b[1]*c[2] + D[5]*b[1]*b[2])/(36*V)
,
(D[0]*b[1]*b[3] + D[18]*b[3]*c[1] + D[21]*c[1]*c[3] + D[23]*c[1]*d[3] + D[3]*b[1]*c[3] + D[30]*b[3]*d[1] + D[33]*c[3]*d[1] + D[35]*d[1]*d[3] + D[5]*b[1]*d[3])/(36*V)
,
(D[1]*b[1]*c[3] + D[19]*c[1]*c[3] + D[21]*b[3]*c[1] + D[22]*c[1]*d[3] + D[3]*b[1]*b[3] + D[31]*c[3]*d[1] + D[33]*b[3]*d[1] + D[34]*d[1]*d[3] + D[4]*b[1]*d[3])/(36*V)
,
(D[2]*b[1]*d[3] + D[20]*c[1]*d[3] + D[22]*c[1]*c[3] + D[23]*b[3]*c[1] + D[32]*d[1]*d[3] + D[34]*c[3]*d[1] + D[35]*b[3]*d[1] + D[4]*b[1]*c[3] + D[5]*b[1]*b[3])/(36*V)
,
(D[11]*c[1]*d[0] + D[18]*b[0]*b[1] + D[21]*b[1]*c[0] + D[23]*b[1]*d[0] + D[24]*b[0]*d[1] + D[27]*c[0]*d[1] + D[29]*d[0]*d[1] + D[6]*b[0]*c[1] + D[9]*c[0]*c[1])/(36*V)
,
(D[10]*c[1]*d[0] + D[19]*b[1]*c[0] + D[21]*b[0]*b[1] + D[22]*b[1]*d[0] + D[25]*c[0]*d[1] + D[27]*b[0]*d[1] + D[28]*d[0]*d[1] + D[7]*c[0]*c[1] + D[9]*b[0]*c[1])/(36*V)
,
(D[10]*c[0]*c[1] + D[11]*b[0]*c[1] + D[20]*b[1]*d[0] + D[22]*b[1]*c[0] + D[23]*b[0]*b[1] + D[26]*d[0]*d[1] + D[28]*c[0]*d[1] + D[29]*b[0]*d[1] + D[8]*c[1]*d[0])/(36*V)
,
(D[11]*c[1]*d[1] + D[18]*b[1]*b[1] + D[21]*b[1]*c[1] + D[23]*b[1]*d[1] + D[24]*b[1]*d[1] + D[27]*c[1]*d[1] + D[29]*d[1]*d[1] + D[6]*b[1]*c[1] + D[9]*c[1]*c[1])/(36*V)
,
(D[10]*c[1]*d[1] + D[19]*b[1]*c[1] + D[21]*b[1]*b[1] + D[22]*b[1]*d[1] + D[25]*c[1]*d[1] + D[27]*b[1]*d[1] + D[28]*d[1]*d[1] + D[7]*c[1]*c[1] + D[9]*b[1]*c[1])/(36*V)
,
(D[10]*c[1]*c[1] + D[11]*b[1]*c[1] + D[20]*b[1]*d[1] + D[22]*b[1]*c[1] + D[23]*b[1]*b[1] + D[26]*d[1]*d[1] + D[28]*c[1]*d[1] + D[29]*b[1]*d[1] + D[8]*c[1]*d[1])/(36*V)
,
(D[11]*c[1]*d[2] + D[18]*b[1]*b[2] + D[21]*b[1]*c[2] + D[23]*b[1]*d[2] + D[24]*b[2]*d[1] + D[27]*c[2]*d[1] + D[29]*d[1]*d[2] + D[6]*b[2]*c[1] + D[9]*c[1]*c[2])/(36*V)
,
(D[10]*c[1]*d[2] + D[19]*b[1]*c[2] + D[21]*b[1]*b[2] + D[22]*b[1]*d[2] + D[25]*c[2]*d[1] + D[27]*b[2]*d[1] + D[28]*d[1]*d[2] + D[7]*c[1]*c[2] + D[9]*b[2]*c[1])/(36*V)
,
(D[10]*c[1]*c[2] + D[11]*b[2]*c[1] + D[20]*b[1]*d[2] + D[22]*b[1]*c[2] + D[23]*b[1]*b[2] + D[26]*d[1]*d[2] + D[28]*c[2]*d[1] + D[29]*b[2]*d[1] + D[8]*c[1]*d[2])/(36*V)
,
(D[11]*c[1]*d[3] + D[18]*b[1]*b[3] + D[21]*b[1]*c[3] + D[23]*b[1]*d[3] + D[24]*b[3]*d[1] + D[27]*c[3]*d[1] + D[29]*d[1]*d[3] + D[6]*b[3]*c[1] + D[9]*c[1]*c[3])/(36*V)
,
(D[10]*c[1]*d[3] + D[19]*b[1]*c[3] + D[21]*b[1]*b[3] + D[22]*b[1]*d[3] + D[25]*c[3]*d[1] + D[27]*b[3]*d[1] + D[28]*d[1]*d[3] + D[7]*c[1]*c[3] + D[9]*b[3]*c[1])/(36*V)
,
(D[10]*c[1]*c[3] + D[11]*b[3]*c[1] + D[20]*b[1]*d[3] + D[22]*b[1]*c[3] + D[23]*b[1]*b[3] + D[26]*d[1]*d[3] + D[28]*c[3]*d[1] + D[29]*b[3]*d[1] + D[8]*c[1]*d[3])/(36*V)
,
(D[12]*b[0]*d[1] + D[15]*c[0]*d[1] + D[17]*d[0]*d[1] + D[24]*b[0]*c[1] + D[27]*c[0]*c[1] + D[29]*c[1]*d[0] + D[30]*b[0]*b[1] + D[33]*b[1]*c[0] + D[35]*b[1]*d[0])/(36*V)
,
(D[13]*c[0]*d[1] + D[15]*b[0]*d[1] + D[16]*d[0]*d[1] + D[25]*c[0]*c[1] + D[27]*b[0]*c[1] + D[28]*c[1]*d[0] + D[31]*b[1]*c[0] + D[33]*b[0]*b[1] + D[34]*b[1]*d[0])/(36*V)
,
(D[14]*d[0]*d[1] + D[16]*c[0]*d[1] + D[17]*b[0]*d[1] + D[26]*c[1]*d[0] + D[28]*c[0]*c[1] + D[29]*b[0]*c[1] + D[32]*b[1]*d[0] + D[34]*b[1]*c[0] + D[35]*b[0]*b[1])/(36*V)
,
(D[12]*b[1]*d[1] + D[15]*c[1]*d[1] + D[17]*d[1]*d[1] + D[24]*b[1]*c[1] + D[27]*c[1]*c[1] + D[29]*c[1]*d[1] + D[30]*b[1]*b[1] + D[33]*b[1]*c[1] + D[35]*b[1]*d[1])/(36*V)
,
(D[13]*c[1]*d[1] + D[15]*b[1]*d[1] + D[16]*d[1]*d[1] + D[25]*c[1]*c[1] + D[27]*b[1]*c[1] + D[28]*c[1]*d[1] + D[31]*b[1]*c[1] + D[33]*b[1]*b[1] + D[34]*b[1]*d[1])/(36*V)
,
(D[14]*d[1]*d[1] + D[16]*c[1]*d[1] + D[17]*b[1]*d[1] + D[26]*c[1]*d[1] + D[28]*c[1]*c[1] + D[29]*b[1]*c[1] + D[32]*b[1]*d[1] + D[34]*b[1]*c[1] + D[35]*b[1]*b[1])/(36*V)
,
(D[12]*b[2]*d[1] + D[15]*c[2]*d[1] + D[17]*d[1]*d[2] + D[24]*b[2]*c[1] + D[27]*c[1]*c[2] + D[29]*c[1]*d[2] + D[30]*b[1]*b[2] + D[33]*b[1]*c[2] + D[35]*b[1]*d[2])/(36*V)
,
(D[13]*c[2]*d[1] + D[15]*b[2]*d[1] + D[16]*d[1]*d[2] + D[25]*c[1]*c[2] + D[27]*b[2]*c[1] + D[28]*c[1]*d[2] + D[31]*b[1]*c[2] + D[33]*b[1]*b[2] + D[34]*b[1]*d[2])/(36*V)
,
(D[14]*d[1]*d[2] + D[16]*c[2]*d[1] + D[17]*b[2]*d[1] + D[26]*c[1]*d[2] + D[28]*c[1]*c[2] + D[29]*b[2]*c[1] + D[32]*b[1]*d[2] + D[34]*b[1]*c[2] + D[35]*b[1]*b[2])/(36*V)
,
(D[12]*b[3]*d[1] + D[15]*c[3]*d[1] + D[17]*d[1]*d[3] + D[24]*b[3]*c[1] + D[27]*c[1]*c[3] + D[29]*c[1]*d[3] + D[30]*b[1]*b[3] + D[33]*b[1]*c[3] + D[35]*b[1]*d[3])/(36*V)
,
(D[13]*c[3]*d[1] + D[15]*b[3]*d[1] + D[16]*d[1]*d[3] + D[25]*c[1]*c[3] + D[27]*b[3]*c[1] + D[28]*c[1]*d[3] + D[31]*b[1]*c[3] + D[33]*b[1]*b[3] + D[34]*b[1]*d[3])/(36*V)
,
(D[14]*d[1]*d[3] + D[16]*c[3]*d[1] + D[17]*b[3]*d[1] + D[26]*c[1]*d[3] + D[28]*c[1]*c[3] + D[29]*b[3]*c[1] + D[32]*b[1]*d[3] + D[34]*b[1]*c[3] + D[35]*b[1]*b[3])/(36*V)
,
(D[0]*b[0]*b[2] + D[18]*b[0]*c[2] + D[21]*c[0]*c[2] + D[23]*c[2]*d[0] + D[3]*b[2]*c[0] + D[30]*b[0]*d[2] + D[33]*c[0]*d[2] + D[35]*d[0]*d[2] + D[5]*b[2]*d[0])/(36*V)
,
(D[1]*b[2]*c[0] + D[19]*c[0]*c[2] + D[21]*b[0]*c[2] + D[22]*c[2]*d[0] + D[3]*b[0]*b[2] + D[31]*c[0]*d[2] + D[33]*b[0]*d[2] + D[34]*d[0]*d[2] + D[4]*b[2]*d[0])/(36*V)
,
(D[2]*b[2]*d[0] + D[20]*c[2]*d[0] + D[22]*c[0]*c[2] + D[23]*b[0]*c[2] + D[32]*d[0]*d[2] + D[34]*c[0]*d[2] + D[35]*b[0]*d[2] + D[4]*b[2]*c[0] + D[5]*b[0]*b[2])/(36*V)
,
(D[0]*b[1]*b[2] + D[18]*b[1]*c[2] + D[21]*c[1]*c[2] + D[23]*c[2]*d[1] + D[3]*b[2]*c[1] + D[30]*b[1]*d[2] + D[33]*c[1]*d[2] + D[35]*d[1]*d[2] + D[5]*b[2]*d[1])/(36*V)
,
(D[1]*b[2]*c[1] + D[19]*c[1]*c[2] + D[21]*b[1]*c[2] + D[22]*c[2]*d[1] + D[3]*b[1]*b[2] + D[31]*c[1]*d[2] + D[33]*b[1]*d[2] + D[34]*d[1]*d[2] + D[4]*b[2]*d[1])/(36*V)
,
(D[2]*b[2]*d[1] + D[20]*c[2]*d[1] + D[22]*c[1]*c[2] + D[23]*b[1]*c[2] + D[32]*d[1]*d[2] + D[34]*c[1]*d[2] + D[35]*b[1]*d[2] + D[4]*b[2]*c[1] + D[5]*b[1]*b[2])/(36*V)
,
(D[0]*b[2]*b[2] + D[18]*b[2]*c[2] + D[21]*c[2]*c[2] + D[23]*c[2]*d[2] + D[3]*b[2]*c[2] + D[30]*b[2]*d[2] + D[33]*c[2]*d[2] + D[35]*d[2]*d[2] + D[5]*b[2]*d[2])/(36*V)
,
(D[1]*b[2]*c[2] + D[19]*c[2]*c[2] + D[21]*b[2]*c[2] + D[22]*c[2]*d[2] + D[3]*b[2]*b[2] + D[31]*c[2]*d[2] + D[33]*b[2]*d[2] + D[34]*d[2]*d[2] + D[4]*b[2]*d[2])/(36*V)
,
(D[2]*b[2]*d[2] + D[20]*c[2]*d[2] + D[22]*c[2]*c[2] + D[23]*b[2]*c[2] + D[32]*d[2]*d[2] + D[34]*c[2]*d[2] + D[35]*b[2]*d[2] + D[4]*b[2]*c[2] + D[5]*b[2]*b[2])/(36*V)
,
(D[0]*b[2]*b[3] + D[18]*b[3]*c[2] + D[21]*c[2]*c[3] + D[23]*c[2]*d[3] + D[3]*b[2]*c[3] + D[30]*b[3]*d[2] + D[33]*c[3]*d[2] + D[35]*d[2]*d[3] + D[5]*b[2]*d[3])/(36*V)
,
(D[1]*b[2]*c[3] + D[19]*c[2]*c[3] + D[21]*b[3]*c[2] + D[22]*c[2]*d[3] + D[3]*b[2]*b[3] + D[31]*c[3]*d[2] + D[33]*b[3]*d[2] + D[34]*d[2]*d[3] + D[4]*b[2]*d[3])/(36*V)
,
(D[2]*b[2]*d[3] + D[20]*c[2]*d[3] + D[22]*c[2]*c[3] + D[23]*b[3]*c[2] + D[32]*d[2]*d[3] + D[34]*c[3]*d[2] + D[35]*b[3]*d[2] + D[4]*b[2]*c[3] + D[5]*b[2]*b[3])/(36*V)
,
(D[11]*c[2]*d[0] + D[18]*b[0]*b[2] + D[21]*b[2]*c[0] + D[23]*b[2]*d[0] + D[24]*b[0]*d[2] + D[27]*c[0]*d[2] + D[29]*d[0]*d[2] + D[6]*b[0]*c[2] + D[9]*c[0]*c[2])/(36*V)
,
(D[10]*c[2]*d[0] + D[19]*b[2]*c[0] + D[21]*b[0]*b[2] + D[22]*b[2]*d[0] + D[25]*c[0]*d[2] + D[27]*b[0]*d[2] + D[28]*d[0]*d[2] + D[7]*c[0]*c[2] + D[9]*b[0]*c[2])/(36*V)
,
(D[10]*c[0]*c[2] + D[11]*b[0]*c[2] + D[20]*b[2]*d[0] + D[22]*b[2]*c[0] + D[23]*b[0]*b[2] + D[26]*d[0]*d[2] + D[28]*c[0]*d[2] + D[29]*b[0]*d[2] + D[8]*c[2]*d[0])/(36*V)
,
(D[11]*c[2]*d[1] + D[18]*b[1]*b[2] + D[21]*b[2]*c[1] + D[23]*b[2]*d[1] + D[24]*b[1]*d[2] + D[27]*c[1]*d[2] + D[29]*d[1]*d[2] + D[6]*b[1]*c[2] + D[9]*c[1]*c[2])/(36*V)
,
(D[10]*c[2]*d[1] + D[19]*b[2]*c[1] + D[21]*b[1]*b[2] + D[22]*b[2]*d[1] + D[25]*c[1]*d[2] + D[27]*b[1]*d[2] + D[28]*d[1]*d[2] + D[7]*c[1]*c[2] + D[9]*b[1]*c[2])/(36*V)
,
(D[10]*c[1]*c[2] + D[11]*b[1]*c[2] + D[20]*b[2]*d[1] + D[22]*b[2]*c[1] + D[23]*b[1]*b[2] + D[26]*d[1]*d[2] + D[28]*c[1]*d[2] + D[29]*b[1]*d[2] + D[8]*c[2]*d[1])/(36*V)
,
(D[11]*c[2]*d[2] + D[18]*b[2]*b[2] + D[21]*b[2]*c[2] + D[23]*b[2]*d[2] + D[24]*b[2]*d[2] + D[27]*c[2]*d[2] + D[29]*d[2]*d[2] + D[6]*b[2]*c[2] + D[9]*c[2]*c[2])/(36*V)
,
(D[10]*c[2]*d[2] + D[19]*b[2]*c[2] + D[21]*b[2]*b[2] + D[22]*b[2]*d[2] + D[25]*c[2]*d[2] + D[27]*b[2]*d[2] + D[28]*d[2]*d[2] + D[7]*c[2]*c[2] + D[9]*b[2]*c[2])/(36*V)
,
(D[10]*c[2]*c[2] + D[11]*b[2]*c[2] + D[20]*b[2]*d[2] + D[22]*b[2]*c[2] + D[23]*b[2]*b[2] + D[26]*d[2]*d[2] + D[28]*c[2]*d[2] + D[29]*b[2]*d[2] + D[8]*c[2]*d[2])/(36*V)
,
(D[11]*c[2]*d[3] + D[18]*b[2]*b[3] + D[21]*b[2]*c[3] + D[23]*b[2]*d[3] + D[24]*b[3]*d[2] + D[27]*c[3]*d[2] + D[29]*d[2]*d[3] + D[6]*b[3]*c[2] + D[9]*c[2]*c[3])/(36*V)
,
(D[10]*c[2]*d[3] + D[19]*b[2]*c[3] + D[21]*b[2]*b[3] + D[22]*b[2]*d[3] + D[25]*c[3]*d[2] + D[27]*b[3]*d[2] + D[28]*d[2]*d[3] + D[7]*c[2]*c[3] + D[9]*b[3]*c[2])/(36*V)
,
(D[10]*c[2]*c[3] + D[11]*b[3]*c[2] + D[20]*b[2]*d[3] + D[22]*b[2]*c[3] + D[23]*b[2]*b[3] + D[26]*d[2]*d[3] + D[28]*c[3]*d[2] + D[29]*b[3]*d[2] + D[8]*c[2]*d[3])/(36*V)
,
(D[12]*b[0]*d[2] + D[15]*c[0]*d[2] + D[17]*d[0]*d[2] + D[24]*b[0]*c[2] + D[27]*c[0]*c[2] + D[29]*c[2]*d[0] + D[30]*b[0]*b[2] + D[33]*b[2]*c[0] + D[35]*b[2]*d[0])/(36*V)
,
(D[13]*c[0]*d[2] + D[15]*b[0]*d[2] + D[16]*d[0]*d[2] + D[25]*c[0]*c[2] + D[27]*b[0]*c[2] + D[28]*c[2]*d[0] + D[31]*b[2]*c[0] + D[33]*b[0]*b[2] + D[34]*b[2]*d[0])/(36*V)
,
(D[14]*d[0]*d[2] + D[16]*c[0]*d[2] + D[17]*b[0]*d[2] + D[26]*c[2]*d[0] + D[28]*c[0]*c[2] + D[29]*b[0]*c[2] + D[32]*b[2]*d[0] + D[34]*b[2]*c[0] + D[35]*b[0]*b[2])/(36*V)
,
(D[12]*b[1]*d[2] + D[15]*c[1]*d[2] + D[17]*d[1]*d[2] + D[24]*b[1]*c[2] + D[27]*c[1]*c[2] + D[29]*c[2]*d[1] + D[30]*b[1]*b[2] + D[33]*b[2]*c[1] + D[35]*b[2]*d[1])/(36*V)
,
(D[13]*c[1]*d[2] + D[15]*b[1]*d[2] + D[16]*d[1]*d[2] + D[25]*c[1]*c[2] + D[27]*b[1]*c[2] + D[28]*c[2]*d[1] + D[31]*b[2]*c[1] + D[33]*b[1]*b[2] + D[34]*b[2]*d[1])/(36*V)
,
(D[14]*d[1]*d[2] + D[16]*c[1]*d[2] + D[17]*b[1]*d[2] + D[26]*c[2]*d[1] + D[28]*c[1]*c[2] + D[29]*b[1]*c[2] + D[32]*b[2]*d[1] + D[34]*b[2]*c[1] + D[35]*b[1]*b[2])/(36*V)
,
(D[12]*b[2]*d[2] + D[15]*c[2]*d[2] + D[17]*d[2]*d[2] + D[24]*b[2]*c[2] + D[27]*c[2]*c[2] + D[29]*c[2]*d[2] + D[30]*b[2]*b[2] + D[33]*b[2]*c[2] + D[35]*b[2]*d[2])/(36*V)
,
(D[13]*c[2]*d[2] + D[15]*b[2]*d[2] + D[16]*d[2]*d[2] + D[25]*c[2]*c[2] + D[27]*b[2]*c[2] + D[28]*c[2]*d[2] + D[31]*b[2]*c[2] + D[33]*b[2]*b[2] + D[34]*b[2]*d[2])/(36*V)
,
(D[14]*d[2]*d[2] + D[16]*c[2]*d[2] + D[17]*b[2]*d[2] + D[26]*c[2]*d[2] + D[28]*c[2]*c[2] + D[29]*b[2]*c[2] + D[32]*b[2]*d[2] + D[34]*b[2]*c[2] + D[35]*b[2]*b[2])/(36*V)
,
(D[12]*b[3]*d[2] + D[15]*c[3]*d[2] + D[17]*d[2]*d[3] + D[24]*b[3]*c[2] + D[27]*c[2]*c[3] + D[29]*c[2]*d[3] + D[30]*b[2]*b[3] + D[33]*b[2]*c[3] + D[35]*b[2]*d[3])/(36*V)
,
(D[13]*c[3]*d[2] + D[15]*b[3]*d[2] + D[16]*d[2]*d[3] + D[25]*c[2]*c[3] + D[27]*b[3]*c[2] + D[28]*c[2]*d[3] + D[31]*b[2]*c[3] + D[33]*b[2]*b[3] + D[34]*b[2]*d[3])/(36*V)
,
(D[14]*d[2]*d[3] + D[16]*c[3]*d[2] + D[17]*b[3]*d[2] + D[26]*c[2]*d[3] + D[28]*c[2]*c[3] + D[29]*b[3]*c[2] + D[32]*b[2]*d[3] + D[34]*b[2]*c[3] + D[35]*b[2]*b[3])/(36*V)
,
(D[0]*b[0]*b[3] + D[18]*b[0]*c[3] + D[21]*c[0]*c[3] + D[23]*c[3]*d[0] + D[3]*b[3]*c[0] + D[30]*b[0]*d[3] + D[33]*c[0]*d[3] + D[35]*d[0]*d[3] + D[5]*b[3]*d[0])/(36*V)
,
(D[1]*b[3]*c[0] + D[19]*c[0]*c[3] + D[21]*b[0]*c[3] + D[22]*c[3]*d[0] + D[3]*b[0]*b[3] + D[31]*c[0]*d[3] + D[33]*b[0]*d[3] + D[34]*d[0]*d[3] + D[4]*b[3]*d[0])/(36*V)
,
(D[2]*b[3]*d[0] + D[20]*c[3]*d[0] + D[22]*c[0]*c[3] + D[23]*b[0]*c[3] + D[32]*d[0]*d[3] + D[34]*c[0]*d[3] + D[35]*b[0]*d[3] + D[4]*b[3]*c[0] + D[5]*b[0]*b[3])/(36*V)
,
(D[0]*b[1]*b[3] + D[18]*b[1]*c[3] + D[21]*c[1]*c[3] + D[23]*c[3]*d[1] + D[3]*b[3]*c[1] + D[30]*b[1]*d[3] + D[33]*c[1]*d[3] + D[35]*d[1]*d[3] + D[5]*b[3]*d[1])/(36*V)
,
(D[1]*b[3]*c[1] + D[19]*c[1]*c[3] + D[21]*b[1]*c[3] + D[22]*c[3]*d[1] + D[3]*b[1]*b[3] + D[31]*c[1]*d[3] + D[33]*b[1]*d[3] + D[34]*d[1]*d[3] + D[4]*b[3]*d[1])/(36*V)
,
(D[2]*b[3]*d[1] + D[20]*c[3]*d[1] + D[22]*c[1]*c[3] + D[23]*b[1]*c[3] + D[32]*d[1]*d[3] + D[34]*c[1]*d[3] + D[35]*b[1]*d[3] + D[4]*b[3]*c[1] + D[5]*b[1]*b[3])/(36*V)
,
(D[0]*b[2]*b[3] + D[18]*b[2]*c[3] + D[21]*c[2]*c[3] + D[23]*c[3]*d[2] + D[3]*b[3]*c[2] + D[30]*b[2]*d[3] + D[33]*c[2]*d[3] + D[35]*d[2]*d[3] + D[5]*b[3]*d[2])/(36*V)
,
(D[1]*b[3]*c[2] + D[19]*c[2]*c[3] + D[21]*b[2]*c[3] + D[22]*c[3]*d[2] + D[3]*b[2]*b[3] + D[31]*c[2]*d[3] + D[33]*b[2]*d[3] + D[34]*d[2]*d[3] + D[4]*b[3]*d[2])/(36*V)
,
(D[2]*b[3]*d[2] + D[20]*c[3]*d[2] + D[22]*c[2]*c[3] + D[23]*b[2]*c[3] + D[32]*d[2]*d[3] + D[34]*c[2]*d[3] + D[35]*b[2]*d[3] + D[4]*b[3]*c[2] + D[5]*b[2]*b[3])/(36*V)
,
(D[0]*b[3]*b[3] + D[18]*b[3]*c[3] + D[21]*c[3]*c[3] + D[23]*c[3]*d[3] + D[3]*b[3]*c[3] + D[30]*b[3]*d[3] + D[33]*c[3]*d[3] + D[35]*d[3]*d[3] + D[5]*b[3]*d[3])/(36*V)
,
(D[1]*b[3]*c[3] + D[19]*c[3]*c[3] + D[21]*b[3]*c[3] + D[22]*c[3]*d[3] + D[3]*b[3]*b[3] + D[31]*c[3]*d[3] + D[33]*b[3]*d[3] + D[34]*d[3]*d[3] + D[4]*b[3]*d[3])/(36*V)
,
(D[2]*b[3]*d[3] + D[20]*c[3]*d[3] + D[22]*c[3]*c[3] + D[23]*b[3]*c[3] + D[32]*d[3]*d[3] + D[34]*c[3]*d[3] + D[35]*b[3]*d[3] + D[4]*b[3]*c[3] + D[5]*b[3]*b[3])/(36*V)
,
(D[11]*c[3]*d[0] + D[18]*b[0]*b[3] + D[21]*b[3]*c[0] + D[23]*b[3]*d[0] + D[24]*b[0]*d[3] + D[27]*c[0]*d[3] + D[29]*d[0]*d[3] + D[6]*b[0]*c[3] + D[9]*c[0]*c[3])/(36*V)
,
(D[10]*c[3]*d[0] + D[19]*b[3]*c[0] + D[21]*b[0]*b[3] + D[22]*b[3]*d[0] + D[25]*c[0]*d[3] + D[27]*b[0]*d[3] + D[28]*d[0]*d[3] + D[7]*c[0]*c[3] + D[9]*b[0]*c[3])/(36*V)
,
(D[10]*c[0]*c[3] + D[11]*b[0]*c[3] + D[20]*b[3]*d[0] + D[22]*b[3]*c[0] + D[23]*b[0]*b[3] + D[26]*d[0]*d[3] + D[28]*c[0]*d[3] + D[29]*b[0]*d[3] + D[8]*c[3]*d[0])/(36*V)
,
(D[11]*c[3]*d[1] + D[18]*b[1]*b[3] + D[21]*b[3]*c[1] + D[23]*b[3]*d[1] + D[24]*b[1]*d[3] + D[27]*c[1]*d[3] + D[29]*d[1]*d[3] + D[6]*b[1]*c[3] + D[9]*c[1]*c[3])/(36*V)
,
(D[10]*c[3]*d[1] + D[19]*b[3]*c[1] + D[21]*b[1]*b[3] + D[22]*b[3]*d[1] + D[25]*c[1]*d[3] + D[27]*b[1]*d[3] + D[28]*d[1]*d[3] + D[7]*c[1]*c[3] + D[9]*b[1]*c[3])/(36*V)
,
(D[10]*c[1]*c[3] + D[11]*b[1]*c[3] + D[20]*b[3]*d[1] + D[22]*b[3]*c[1] + D[23]*b[1]*b[3] + D[26]*d[1]*d[3] + D[28]*c[1]*d[3] + D[29]*b[1]*d[3] + D[8]*c[3]*d[1])/(36*V)
,
(D[11]*c[3]*d[2] + D[18]*b[2]*b[3] + D[21]*b[3]*c[2] + D[23]*b[3]*d[2] + D[24]*b[2]*d[3] + D[27]*c[2]*d[3] + D[29]*d[2]*d[3] + D[6]*b[2]*c[3] + D[9]*c[2]*c[3])/(36*V)
,
(D[10]*c[3]*d[2] + D[19]*b[3]*c[2] + D[21]*b[2]*b[3] + D[22]*b[3]*d[2] + D[25]*c[2]*d[3] + D[27]*b[2]*d[3] + D[28]*d[2]*d[3] + D[7]*c[2]*c[3] + D[9]*b[2]*c[3])/(36*V)
,
(D[10]*c[2]*c[3] + D[11]*b[2]*c[3] + D[20]*b[3]*d[2] + D[22]*b[3]*c[2] + D[23]*b[2]*b[3] + D[26]*d[2]*d[3] + D[28]*c[2]*d[3] + D[29]*b[2]*d[3] + D[8]*c[3]*d[2])/(36*V)
,
(D[11]*c[3]*d[3] + D[18]*b[3]*b[3] + D[21]*b[3]*c[3] + D[23]*b[3]*d[3] + D[24]*b[3]*d[3] + D[27]*c[3]*d[3] + D[29]*d[3]*d[3] + D[6]*b[3]*c[3] + D[9]*c[3]*c[3])/(36*V)
,
(D[10]*c[3]*d[3] + D[19]*b[3]*c[3] + D[21]*b[3]*b[3] + D[22]*b[3]*d[3] + D[25]*c[3]*d[3] + D[27]*b[3]*d[3] + D[28]*d[3]*d[3] + D[7]*c[3]*c[3] + D[9]*b[3]*c[3])/(36*V)
,
(D[10]*c[3]*c[3] + D[11]*b[3]*c[3] + D[20]*b[3]*d[3] + D[22]*b[3]*c[3] + D[23]*b[3]*b[3] + D[26]*d[3]*d[3] + D[28]*c[3]*d[3] + D[29]*b[3]*d[3] + D[8]*c[3]*d[3])/(36*V)
,
(D[12]*b[0]*d[3] + D[15]*c[0]*d[3] + D[17]*d[0]*d[3] + D[24]*b[0]*c[3] + D[27]*c[0]*c[3] + D[29]*c[3]*d[0] + D[30]*b[0]*b[3] + D[33]*b[3]*c[0] + D[35]*b[3]*d[0])/(36*V)
,
(D[13]*c[0]*d[3] + D[15]*b[0]*d[3] + D[16]*d[0]*d[3] + D[25]*c[0]*c[3] + D[27]*b[0]*c[3] + D[28]*c[3]*d[0] + D[31]*b[3]*c[0] + D[33]*b[0]*b[3] + D[34]*b[3]*d[0])/(36*V)
,
(D[14]*d[0]*d[3] + D[16]*c[0]*d[3] + D[17]*b[0]*d[3] + D[26]*c[3]*d[0] + D[28]*c[0]*c[3] + D[29]*b[0]*c[3] + D[32]*b[3]*d[0] + D[34]*b[3]*c[0] + D[35]*b[0]*b[3])/(36*V)
,
(D[12]*b[1]*d[3] + D[15]*c[1]*d[3] + D[17]*d[1]*d[3] + D[24]*b[1]*c[3] + D[27]*c[1]*c[3] + D[29]*c[3]*d[1] + D[30]*b[1]*b[3] + D[33]*b[3]*c[1] + D[35]*b[3]*d[1])/(36*V)
,
(D[13]*c[1]*d[3] + D[15]*b[1]*d[3] + D[16]*d[1]*d[3] + D[25]*c[1]*c[3] + D[27]*b[1]*c[3] + D[28]*c[3]*d[1] + D[31]*b[3]*c[1] + D[33]*b[1]*b[3] + D[34]*b[3]*d[1])/(36*V)
,
(D[14]*d[1]*d[3] + D[16]*c[1]*d[3] + D[17]*b[1]*d[3] + D[26]*c[3]*d[1] + D[28]*c[1]*c[3] + D[29]*b[1]*c[3] + D[32]*b[3]*d[1] + D[34]*b[3]*c[1] + D[35]*b[1]*b[3])/(36*V)
,
(D[12]*b[2]*d[3] + D[15]*c[2]*d[3] + D[17]*d[2]*d[3] + D[24]*b[2]*c[3] + D[27]*c[2]*c[3] + D[29]*c[3]*d[2] + D[30]*b[2]*b[3] + D[33]*b[3]*c[2] + D[35]*b[3]*d[2])/(36*V)
,
(D[13]*c[2]*d[3] + D[15]*b[2]*d[3] + D[16]*d[2]*d[3] + D[25]*c[2]*c[3] + D[27]*b[2]*c[3] + D[28]*c[3]*d[2] + D[31]*b[3]*c[2] + D[33]*b[2]*b[3] + D[34]*b[3]*d[2])/(36*V)
,
(D[14]*d[2]*d[3] + D[16]*c[2]*d[3] + D[17]*b[2]*d[3] + D[26]*c[3]*d[2] + D[28]*c[2]*c[3] + D[29]*b[2]*c[3] + D[32]*b[3]*d[2] + D[34]*b[3]*c[2] + D[35]*b[2]*b[3])/(36*V)
,
(D[12]*b[3]*d[3] + D[15]*c[3]*d[3] + D[17]*d[3]*d[3] + D[24]*b[3]*c[3] + D[27]*c[3]*c[3] + D[29]*c[3]*d[3] + D[30]*b[3]*b[3] + D[33]*b[3]*c[3] + D[35]*b[3]*d[3])/(36*V)
,
(D[13]*c[3]*d[3] + D[15]*b[3]*d[3] + D[16]*d[3]*d[3] + D[25]*c[3]*c[3] + D[27]*b[3]*c[3] + D[28]*c[3]*d[3] + D[31]*b[3]*c[3] + D[33]*b[3]*b[3] + D[34]*b[3]*d[3])/(36*V)
,
(D[14]*d[3]*d[3] + D[16]*c[3]*d[3] + D[17]*b[3]*d[3] + D[26]*c[3]*d[3] + D[28]*c[3]*c[3] + D[29]*b[3]*c[3] + D[32]*b[3]*d[3] + D[34]*b[3]*c[3] + D[35]*b[3]*b[3])/(36*V)
};

    return k;
}
std::vector<double> TET4::get_B(const gp_Pnt& point) const{
    (void)point;
    std::vector<double> B{
    b[0]/(6*V)
    ,
    0
    ,
    0
    ,
    b[1]/(6*V)
    ,
    0
    ,
    0
    ,
    b[2]/(6*V)
    ,
    0
    ,
    0
    ,
    b[3]/(6*V)
    ,
    0
    ,
    0
    ,
    0
    ,
    c[0]/(6*V)
    ,
    0
    ,
    0
    ,
    c[1]/(6*V)
    ,
    0
    ,
    0
    ,
    c[2]/(6*V)
    ,
    0
    ,
    0
    ,
    c[3]/(6*V)
    ,
    0
    ,
    0
    ,
    0
    ,
    d[0]/(6*V)
    ,
    0
    ,
    0
    ,
    d[1]/(6*V)
    ,
    0
    ,
    0
    ,
    d[2]/(6*V)
    ,
    0
    ,
    0
    ,
    d[3]/(6*V)
    ,
    c[0]/(6*V)
    ,
    b[0]/(6*V)
    ,
    0
    ,
    c[1]/(6*V)
    ,
    b[1]/(6*V)
    ,
    0
    ,
    c[2]/(6*V)
    ,
    b[2]/(6*V)
    ,
    0
    ,
    c[3]/(6*V)
    ,
    b[3]/(6*V)
    ,
    0
    ,
    0
    ,
    d[0]/(6*V)
    ,
    c[0]/(6*V)
    ,
    0
    ,
    d[1]/(6*V)
    ,
    c[1]/(6*V)
    ,
    0
    ,
    d[2]/(6*V)
    ,
    c[2]/(6*V)
    ,
    0
    ,
    d[3]/(6*V)
    ,
    c[3]/(6*V)
    ,
    d[0]/(6*V)
    ,
    0
    ,
    b[0]/(6*V)
    ,
    d[1]/(6*V)
    ,
    0
    ,
    b[1]/(6*V)
    ,
    d[2]/(6*V)
    ,
    0
    ,
    b[2]/(6*V)
    ,
    d[3]/(6*V)
    ,
    0
    ,
    b[3]/(6*V)
    };
    return B;
}

std::vector<double> TET4::get_DB(const std::vector<double>& D, const gp_Pnt& point) const{
    (void)point;

std::vector<double> DB{
(D[0]*b[0] + D[3]*c[0] + D[5]*d[0])/(6*V)
,
(D[1]*c[0] + D[3]*b[0] + D[4]*d[0])/(6*V)
,
(D[2]*d[0] + D[4]*c[0] + D[5]*b[0])/(6*V)
,
(D[0]*b[1] + D[3]*c[1] + D[5]*d[1])/(6*V)
,
(D[1]*c[1] + D[3]*b[1] + D[4]*d[1])/(6*V)
,
(D[2]*d[1] + D[4]*c[1] + D[5]*b[1])/(6*V)
,
(D[0]*b[2] + D[3]*c[2] + D[5]*d[2])/(6*V)
,
(D[1]*c[2] + D[3]*b[2] + D[4]*d[2])/(6*V)
,
(D[2]*d[2] + D[4]*c[2] + D[5]*b[2])/(6*V)
,
(D[0]*b[3] + D[3]*c[3] + D[5]*d[3])/(6*V)
,
(D[1]*c[3] + D[3]*b[3] + D[4]*d[3])/(6*V)
,
(D[2]*d[3] + D[4]*c[3] + D[5]*b[3])/(6*V)
,
(D[11]*d[0] + D[6]*b[0] + D[9]*c[0])/(6*V)
,
(D[10]*d[0] + D[7]*c[0] + D[9]*b[0])/(6*V)
,
(D[10]*c[0] + D[11]*b[0] + D[8]*d[0])/(6*V)
,
(D[11]*d[1] + D[6]*b[1] + D[9]*c[1])/(6*V)
,
(D[10]*d[1] + D[7]*c[1] + D[9]*b[1])/(6*V)
,
(D[10]*c[1] + D[11]*b[1] + D[8]*d[1])/(6*V)
,
(D[11]*d[2] + D[6]*b[2] + D[9]*c[2])/(6*V)
,
(D[10]*d[2] + D[7]*c[2] + D[9]*b[2])/(6*V)
,
(D[10]*c[2] + D[11]*b[2] + D[8]*d[2])/(6*V)
,
(D[11]*d[3] + D[6]*b[3] + D[9]*c[3])/(6*V)
,
(D[10]*d[3] + D[7]*c[3] + D[9]*b[3])/(6*V)
,
(D[10]*c[3] + D[11]*b[3] + D[8]*d[3])/(6*V)
,
(D[12]*b[0] + D[15]*c[0] + D[17]*d[0])/(6*V)
,
(D[13]*c[0] + D[15]*b[0] + D[16]*d[0])/(6*V)
,
(D[14]*d[0] + D[16]*c[0] + D[17]*b[0])/(6*V)
,
(D[12]*b[1] + D[15]*c[1] + D[17]*d[1])/(6*V)
,
(D[13]*c[1] + D[15]*b[1] + D[16]*d[1])/(6*V)
,
(D[14]*d[1] + D[16]*c[1] + D[17]*b[1])/(6*V)
,
(D[12]*b[2] + D[15]*c[2] + D[17]*d[2])/(6*V)
,
(D[13]*c[2] + D[15]*b[2] + D[16]*d[2])/(6*V)
,
(D[14]*d[2] + D[16]*c[2] + D[17]*b[2])/(6*V)
,
(D[12]*b[3] + D[15]*c[3] + D[17]*d[3])/(6*V)
,
(D[13]*c[3] + D[15]*b[3] + D[16]*d[3])/(6*V)
,
(D[14]*d[3] + D[16]*c[3] + D[17]*b[3])/(6*V)
,
(D[18]*b[0] + D[21]*c[0] + D[23]*d[0])/(6*V)
,
(D[19]*c[0] + D[21]*b[0] + D[22]*d[0])/(6*V)
,
(D[20]*d[0] + D[22]*c[0] + D[23]*b[0])/(6*V)
,
(D[18]*b[1] + D[21]*c[1] + D[23]*d[1])/(6*V)
,
(D[19]*c[1] + D[21]*b[1] + D[22]*d[1])/(6*V)
,
(D[20]*d[1] + D[22]*c[1] + D[23]*b[1])/(6*V)
,
(D[18]*b[2] + D[21]*c[2] + D[23]*d[2])/(6*V)
,
(D[19]*c[2] + D[21]*b[2] + D[22]*d[2])/(6*V)
,
(D[20]*d[2] + D[22]*c[2] + D[23]*b[2])/(6*V)
,
(D[18]*b[3] + D[21]*c[3] + D[23]*d[3])/(6*V)
,
(D[19]*c[3] + D[21]*b[3] + D[22]*d[3])/(6*V)
,
(D[20]*d[3] + D[22]*c[3] + D[23]*b[3])/(6*V)
,
(D[24]*b[0] + D[27]*c[0] + D[29]*d[0])/(6*V)
,
(D[25]*c[0] + D[27]*b[0] + D[28]*d[0])/(6*V)
,
(D[26]*d[0] + D[28]*c[0] + D[29]*b[0])/(6*V)
,
(D[24]*b[1] + D[27]*c[1] + D[29]*d[1])/(6*V)
,
(D[25]*c[1] + D[27]*b[1] + D[28]*d[1])/(6*V)
,
(D[26]*d[1] + D[28]*c[1] + D[29]*b[1])/(6*V)
,
(D[24]*b[2] + D[27]*c[2] + D[29]*d[2])/(6*V)
,
(D[25]*c[2] + D[27]*b[2] + D[28]*d[2])/(6*V)
,
(D[26]*d[2] + D[28]*c[2] + D[29]*b[2])/(6*V)
,
(D[24]*b[3] + D[27]*c[3] + D[29]*d[3])/(6*V)
,
(D[25]*c[3] + D[27]*b[3] + D[28]*d[3])/(6*V)
,
(D[26]*d[3] + D[28]*c[3] + D[29]*b[3])/(6*V)
,
(D[30]*b[0] + D[33]*c[0] + D[35]*d[0])/(6*V)
,
(D[31]*c[0] + D[33]*b[0] + D[34]*d[0])/(6*V)
,
(D[32]*d[0] + D[34]*c[0] + D[35]*b[0])/(6*V)
,
(D[30]*b[1] + D[33]*c[1] + D[35]*d[1])/(6*V)
,
(D[31]*c[1] + D[33]*b[1] + D[34]*d[1])/(6*V)
,
(D[32]*d[1] + D[34]*c[1] + D[35]*b[1])/(6*V)
,
(D[30]*b[2] + D[33]*c[2] + D[35]*d[2])/(6*V)
,
(D[31]*c[2] + D[33]*b[2] + D[34]*d[2])/(6*V)
,
(D[32]*d[2] + D[34]*c[2] + D[35]*b[2])/(6*V)
,
(D[30]*b[3] + D[33]*c[3] + D[35]*d[3])/(6*V)
,
(D[31]*c[3] + D[33]*b[3] + D[34]*d[3])/(6*V)
,
(D[32]*d[3] + D[34]*c[3] + D[35]*b[3])/(6*V)
};

    return DB;
}

std::vector<double> TET4::get_Nf(const double t, const std::vector<gp_Pnt>& points) const{
    (void)t;

    const gp_Vec v1(points[0], points[1]);
    const gp_Vec v2(points[0], points[2]);

    const double AA = v1.Crossed(v2).Magnitude()/6;
    double A[4] = {0,0,0,0};
    for(size_t i = 0; i < 4; ++i){
        for(size_t j = 0; j < 3; ++j){
            if(points[j].IsEqual(this->nodes[i]->point, Precision::Confusion())){
                A[i] = AA;
                break;
            }
        }
    }

    std::vector<double> Nf{
        A[0],  0,  0,
         0, A[0],  0,
         0,  0, A[0],
        A[1],  0,  0,
         0, A[1],  0,
         0,  0, A[1],
        A[2],  0,  0,
         0, A[2],  0,
         0,  0, A[2],
        A[3],  0,  0,
         0, A[3],  0,
         0,  0, A[3]
    };

    return Nf;
}

std::vector<double> TET4::get_phi_radial(const double t, const double beta, const double vp, const std::vector<double>& axis, const std::vector<double>& center, const double rho) const{
    const size_t N = this->NODES_PER_ELEM;

    std::vector<double> x(4);
    std::vector<double> y(4);
    std::vector<double> z(4);
    for(size_t i = 0; i < N; ++i){
        const auto& n = this->nodes[i];
        x[i] = n->point.X();
        y[i] = n->point.Y();
        z[i] = n->point.Z();
    }

    const Eigen::Vector<double, 3> A(axis[0], axis[1], axis[2]);
    const Eigen::Vector<double, 3> C(center[0], center[1], center[2]);

    // (Shunn and Ham, 2012) https://doi.org/10.1016/j.cam.2012.03.032
    const double coeffs_gl[]{
        0.7784952948213300, 0.0738349017262234, 0.0738349017262234, 0.0738349017262234, 0.0476331348432089,
        0.0738349017262234, 0.7784952948213300, 0.0738349017262234, 0.0738349017262234, 0.0476331348432089,
        0.0738349017262234, 0.0738349017262234, 0.7784952948213300, 0.0738349017262234, 0.0476331348432089,
        0.0738349017262234, 0.0738349017262234, 0.0738349017262234, 0.7784952948213300, 0.0476331348432089,
        0.4062443438840510, 0.4062443438840510, 0.0937556561159491, 0.0937556561159491, 0.1349112434378610,
        0.4062443438840510, 0.0937556561159491, 0.4062443438840510, 0.0937556561159491, 0.1349112434378610,
        0.4062443438840510, 0.0937556561159491, 0.0937556561159491, 0.4062443438840510, 0.1349112434378610,
        0.0937556561159491, 0.4062443438840510, 0.4062443438840510, 0.0937556561159491, 0.1349112434378610,
        0.0937556561159491, 0.4062443438840510, 0.0937556561159491, 0.4062443438840510, 0.1349112434378610,
        0.0937556561159491, 0.0937556561159491, 0.4062443438840510, 0.4062443438840510, 0.1349112434378610
    };

    const double* ai = coeffs_gl;
    const double* bi = coeffs_gl+1;
    const double* ci = coeffs_gl+2;
    const double* di = coeffs_gl+3;
    const double* wi = coeffs_gl+4;

    Eigen::Matrix<double, 4, 4> phi;
    phi.fill(0);
    for(long i = 0; i < 10; ++i){

        const double aj = *(ai + 5*i);
        const double bj = *(bi + 5*i);
        const double cj = *(ci + 5*i);
        const double dj = *(di + 5*i);
        const double wj = *(wi + 5*i);

        auto phi_tmp = get_phi_radial_base(aj*x[0] + bj*x[1] + cj*x[2] + dj*x[3],
                                           aj*y[0] + bj*y[1] + cj*y[2] + dj*y[3],
                                           aj*z[0] + bj*z[1] + cj*z[2] + dj*z[3],
                                           A, C,
                                           beta, vp, rho);

        phi += wj*phi_tmp;
    }
    std::vector<double> phi_vec(16,0);
    phi.transposeInPlace();

    std::copy(phi.data(), phi.data()+16, phi_vec.begin());

    return phi_vec;
}

Eigen::Matrix<double, 4, 4> TET4::get_phi_radial_base(const double x, const double y, const double z, const Eigen::Vector<double, 3>& A, const Eigen::Vector<double, 3>& C, const double beta, const double vp, const double rho) const{
    const Eigen::Vector<double, 3> P(x, y, z);
    const Eigen::Vector<double, 3> v = (C - P) + (C - P).dot(A)*A;
    const double vv = v.dot(v);
    const double dv = -3 + A.dot(A);

    const auto NN = this->N_mat_1dof(x, y, z);
    const auto dNN = this->dN_mat_1dof();

    const auto phi = (beta*rho + vp*dv)*NN*NN.transpose() + vv*dNN.transpose()*dNN + vp*NN*v.transpose()*dNN;

    return phi;
}

std::vector<double> TET4::get_phi_grad(const double t, const double beta) const{
    std::vector<double> phi{
    V*beta/10
    ,
    V*beta/20
    ,
    V*beta/20
    ,
    V*beta/20
    ,
    V*beta/20
    ,
    V*beta/10
    ,
    V*beta/20
    ,
    V*beta/20
    ,
    V*beta/20
    ,
    V*beta/20
    ,
    V*beta/10
    ,
    V*beta/20
    ,
    V*beta/20
    ,
    V*beta/20
    ,
    V*beta/20
    ,
    V*beta/10
    };
    return phi;
}

std::vector<double> TET4::get_phi_unidirectional(const double t, const double beta, const double l, const std::vector<double>& v, const double vn) const{
    std::vector<double> phi{
    (V*(-3*V*beta + 2*b[0]*l*v[0]*vn + 2*c[0]*l*v[1]*vn + 2*d[0]*l*v[2]*vn)/48 - b[0]*b[0]*l*l/36 - c[0]*c[0]*l*l/36 - d[0]*d[0]*l*l/36)/V
    ,
    (V*(-3*V*beta + 2*b[1]*l*v[0]*vn + 2*c[1]*l*v[1]*vn + 2*d[1]*l*v[2]*vn)/48 - b[0]*b[1]*l*l/36 - c[0]*c[1]*l*l/36 - d[0]*d[1]*l*l/36)/V
    ,
    (V*(-3*V*beta + 2*b[2]*l*v[0]*vn + 2*c[2]*l*v[1]*vn + 2*d[2]*l*v[2]*vn)/48 - b[0]*b[2]*l*l/36 - c[0]*c[2]*l*l/36 - d[0]*d[2]*l*l/36)/V
    ,
    (V*(-3*V*beta + 2*b[3]*l*v[0]*vn + 2*c[3]*l*v[1]*vn + 2*d[3]*l*v[2]*vn)/48 - b[0]*b[3]*l*l/36 - c[0]*c[3]*l*l/36 - d[0]*d[3]*l*l/36)/V
    ,
    (V*(-3*V*beta + 2*b[0]*l*v[0]*vn + 2*c[0]*l*v[1]*vn + 2*d[0]*l*v[2]*vn)/48 - b[0]*b[1]*l*l/36 - c[0]*c[1]*l*l/36 - d[0]*d[1]*l*l/36)/V
    ,
    (V*(-3*V*beta + 2*b[1]*l*v[0]*vn + 2*c[1]*l*v[1]*vn + 2*d[1]*l*v[2]*vn)/48 - b[1]*b[1]*l*l/36 - c[1]*c[1]*l*l/36 - d[1]*d[1]*l*l/36)/V
    ,
    (V*(-3*V*beta + 2*b[2]*l*v[0]*vn + 2*c[2]*l*v[1]*vn + 2*d[2]*l*v[2]*vn)/48 - b[1]*b[2]*l*l/36 - c[1]*c[2]*l*l/36 - d[1]*d[2]*l*l/36)/V
    ,
    (V*(-3*V*beta + 2*b[3]*l*v[0]*vn + 2*c[3]*l*v[1]*vn + 2*d[3]*l*v[2]*vn)/48 - b[1]*b[3]*l*l/36 - c[1]*c[3]*l*l/36 - d[1]*d[3]*l*l/36)/V
    ,
    (V*(-3*V*beta + 2*b[0]*l*v[0]*vn + 2*c[0]*l*v[1]*vn + 2*d[0]*l*v[2]*vn)/48 - b[0]*b[2]*l*l/36 - c[0]*c[2]*l*l/36 - d[0]*d[2]*l*l/36)/V
    ,
    (V*(-3*V*beta + 2*b[1]*l*v[0]*vn + 2*c[1]*l*v[1]*vn + 2*d[1]*l*v[2]*vn)/48 - b[1]*b[2]*l*l/36 - c[1]*c[2]*l*l/36 - d[1]*d[2]*l*l/36)/V
    ,
    (V*(-3*V*beta + 2*b[2]*l*v[0]*vn + 2*c[2]*l*v[1]*vn + 2*d[2]*l*v[2]*vn)/48 - b[2]*b[2]*l*l/36 - c[2]*c[2]*l*l/36 - d[2]*d[2]*l*l/36)/V
    ,
    (V*(-3*V*beta + 2*b[3]*l*v[0]*vn + 2*c[3]*l*v[1]*vn + 2*d[3]*l*v[2]*vn)/48 - b[2]*b[3]*l*l/36 - c[2]*c[3]*l*l/36 - d[2]*d[3]*l*l/36)/V
    ,
    (V*(-3*V*beta + 2*b[0]*l*v[0]*vn + 2*c[0]*l*v[1]*vn + 2*d[0]*l*v[2]*vn)/48 - b[0]*b[3]*l*l/36 - c[0]*c[3]*l*l/36 - d[0]*d[3]*l*l/36)/V
    ,
    (V*(-3*V*beta + 2*b[1]*l*v[0]*vn + 2*c[1]*l*v[1]*vn + 2*d[1]*l*v[2]*vn)/48 - b[1]*b[3]*l*l/36 - c[1]*c[3]*l*l/36 - d[1]*d[3]*l*l/36)/V
    ,
    (V*(-3*V*beta + 2*b[2]*l*v[0]*vn + 2*c[2]*l*v[1]*vn + 2*d[2]*l*v[2]*vn)/48 - b[2]*b[3]*l*l/36 - c[2]*c[3]*l*l/36 - d[2]*d[3]*l*l/36)/V
    ,
    (V*(-3*V*beta + 2*b[3]*l*v[0]*vn + 2*c[3]*l*v[1]*vn + 2*d[3]*l*v[2]*vn)/48 - b[3]*b[3]*l*l/36 - c[3]*c[3]*l*l/36 - d[3]*d[3]*l*l/36)/V
    };
    return phi;
}

std::vector<double> TET4::helmholtz_tensor(const double t, const double r) const{
    std::vector<double> h{
    (V*V/10 + b[0]*b[0]*r*r/36 + c[0]*c[0]*r*r/36 + d[0]*d[0]*r*r/36)/V
    ,
    (V*V/20 + b[0]*b[1]*r*r/36 + c[0]*c[1]*r*r/36 + d[0]*d[1]*r*r/36)/V
    ,
    (V*V/20 + b[0]*b[2]*r*r/36 + c[0]*c[2]*r*r/36 + d[0]*d[2]*r*r/36)/V
    ,
    (V*V/20 + b[0]*b[3]*r*r/36 + c[0]*c[3]*r*r/36 + d[0]*d[3]*r*r/36)/V
    ,
    (V*V/20 + b[0]*b[1]*r*r/36 + c[0]*c[1]*r*r/36 + d[0]*d[1]*r*r/36)/V
    ,
    (V*V/10 + b[1]*b[1]*r*r/36 + c[1]*c[1]*r*r/36 + d[1]*d[1]*r*r/36)/V
    ,
    (V*V/20 + b[1]*b[2]*r*r/36 + c[1]*c[2]*r*r/36 + d[1]*d[2]*r*r/36)/V
    ,
    (V*V/20 + b[1]*b[3]*r*r/36 + c[1]*c[3]*r*r/36 + d[1]*d[3]*r*r/36)/V
    ,
    (V*V/20 + b[0]*b[2]*r*r/36 + c[0]*c[2]*r*r/36 + d[0]*d[2]*r*r/36)/V
    ,
    (V*V/20 + b[1]*b[2]*r*r/36 + c[1]*c[2]*r*r/36 + d[1]*d[2]*r*r/36)/V
    ,
    (V*V/10 + b[2]*b[2]*r*r/36 + c[2]*c[2]*r*r/36 + d[2]*d[2]*r*r/36)/V
    ,
    (V*V/20 + b[2]*b[3]*r*r/36 + c[2]*c[3]*r*r/36 + d[2]*d[3]*r*r/36)/V
    ,
    (V*V/20 + b[0]*b[3]*r*r/36 + c[0]*c[3]*r*r/36 + d[0]*d[3]*r*r/36)/V
    ,
    (V*V/20 + b[1]*b[3]*r*r/36 + c[1]*c[3]*r*r/36 + d[1]*d[3]*r*r/36)/V
    ,
    (V*V/20 + b[2]*b[3]*r*r/36 + c[2]*c[3]*r*r/36 + d[2]*d[3]*r*r/36)/V
    ,
    (V*V/10 + b[3]*b[3]*r*r/36 + c[3]*c[3]*r*r/36 + d[3]*d[3]*r*r/36)/V
    };
    return h;
}

std::vector<double> TET4::helmholtz_vector(const double t) const{
    const double V = this->get_volume(t);

    double Ni = V/NODES_PER_ELEM;

    std::vector<double> NT{Ni, Ni, Ni, Ni};

    return NT;
}

std::vector<double> TET4::get_nodal_density_gradient(gp_Pnt p) const{
    (void)p;
    
    return std::vector<double>{b[0]/(6*V), b[1]/(6*V), b[2]/(6*V), b[3]/(6*V),
                               c[0]/(6*V), c[1]/(6*V), c[2]/(6*V), c[3]/(6*V),
                               d[0]/(6*V), d[1]/(6*V), d[2]/(6*V), d[3]/(6*V)};
}

}
